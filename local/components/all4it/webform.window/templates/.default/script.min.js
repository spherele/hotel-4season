BX.ready(function(){eventsWebformWindow()});function eventsWebformWindow(){clickToSubmitButton()}function clickToSubmitButton(){BX.bind(BX("modal__form"),"submit",function(){var data=new FormData(event.target);data.append("formId",formID);console.log(data);let emptyRequiredFields=validateRequired();if(emptyRequiredFields.length==0){sendAjaxRequest(data);event.target.reset()}event.preventDefault()})}function validateRequired(){let resArray=[];BX("modal-offer-news").querySelectorAll("[data-required]").forEach((name,idx,arr)=>{if(name.id=="dropdown-webform"){$ckeck=0;name.querySelectorAll("input").forEach((name2,idx,arr)=>{if(name2.checked==true){$ckeck++}});if($ckeck==0){resArray.push(name.name);name.style.border="1px solid red"}else{name.style.border=""}}else{if(name.value.trim()==""){name.style.border="1px solid red";resArray.push(name.name)}else{name.style.border=""}}});return resArray}function sendAjaxRequest(data){let loader=BX("preloader");loader.style.display="block";var request=BX.ajax.runComponentAction("rasu:webform.window","webformSet",{mode:"ajax",data:data});request.then(function(response){console.log(response);if(response.data.success==false){console.log(BX.message("requiredFieldsEmptyNotify"));BX.UI.Notification.Center.notify({content:BX.message("requiredFieldsEmptyNotify")});markerRequiredFields(true)}else{markerRequiredFields(false);BX.UI.Notification.Center.notify({content:BX.message("successNotify")});BX.ajax.loadJSON("/rasu/ajax/app_for_training.php",CRM_ENTITY_PARAMS,BX.delegate(function(r){console.log(r)},this));BX.fireEvent(BX("closeModalNews"),"click")}loader.style.display="none"});request.catch(function(response){loader.style.display="none"})}function markerRequiredFields(flag){if(flag===true){document.getElementById("modal-offer-news").querySelectorAll("[data-required]").forEach((name,idx,arr)=>{name.style.border="1px solid red"})}else{document.getElementById("modal-offer-news").querySelectorAll("[data-required]").forEach((name,idx,arr)=>{name.style.border=""})}}